This code is hellish and not production ready